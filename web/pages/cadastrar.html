<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Easier ph</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet" />
    <link href="../font-awesome/css/font-awesome.css" rel="stylesheet" />

    <!-- Toastr style -->
    <link href="../css/plugins/toastr/toastr.min.css" rel="stylesheet" />

    <!-- Gritter -->
    <link href="../js/plugins/gritter/jquery.gritter.css" rel="stylesheet" />

    <link href="../css/animate.css" rel="stylesheet" />
    <link href="../css/style.css" rel="stylesheet" />
</head>

<body>
    <div id="wrapper">
        <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav metismenu" id="side-menu">
                    <li class="nav-header">
                        <div class="dropdown profile-element">
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                <span class="block m-t-xs font-bold">Nome do adm logado</span>
                            </a>
                        </div>
                        <div class="logo-element">Easier pH</div>
                    </li>
                    <li>
                        <a href="../index.html"><i class="fa fa-home"></i>
                            <span class="nav-label">Home</span></a>
                    </li>

                    <!-- EXIBIR MENU CADASTRAR APENAS PARA ADM -->
                    <li class="active">
                        <a href="../pages/cadastrar.html"><i class="fa fa-plus-circle"></i>
                            <span class="nav-label">Cadastrar</span></a>
                    </li>

                    <li>
                        <a href="../pages/consultar.html"><i class="fa fa-search"></i>
                            <span class="nav-label">Consultar</span></a>
                    </li>
                </ul>
            </div>
        </nav>

        <div id="page-wrapper" class="gray-bg">
            <!-- Div para header -->
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                    <div class="navbar-header">
                        <a class="navbar-minimalize minimalize-styl-2 btn btn-primary" href="#"><i
                                class="fa fa-bars"></i>
                        </a>
                    </div>
                    <ul class="nav navbar-top-links navbar-right">
                        <li style="padding: 20px">
                            <span class="m-r-sm text-muted welcome-message">Welcome to INSPINIA+ Admin Theme.</span>
                        </li>

                        <li>
                            <a href="login.html">
                                <i class="fa fa-sign-out"></i> Log out
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <!-- Div para título da página -->
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-12">
                    <h2>Cadastrar</h2>
                </div>
            </div>
            <!-- Div para campo de conculta e tabela de aparelhos -->
            <div class="row justify-content-md-center mt-3">
                <div class="col-lg-4"></div>
                <div class="col">
                    <!-- Div para informar o cpf/cnpj -->
                    <div class="">
                        <div class="ibox-title">
                            <h5>Informe um CPF/CNPJ</h5>
                        </div>

                        <div class="ibox-content">
                            <form id="formCheckUser">
                                <div class="form-group row">
                                    <div class="col-sm-12">
                                        <label class="col-form-label" for="inputCpfCnpj">CPF / CNPJ</label>
                                        <input type="text" class="form-control" name="inputCpfCnpj" id="inputCpfCnpj"
                                            value="" required maxlength="18" data-user />
                                        <span class="text-muted">Insira apenas números</span>
                                        <div class="row-sm-2 mt-3">
                                            <button class="btn btn-primary" type="submit" name="buttonCheckUser"
                                                id="buttonCheckUser">
                                                Avançar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- Div para informar os dados do usuário -->
                    <div class="mt-3" id="divAddForm">
                        <div class="ibox-title">
                            <h5>Formulário de cadastro</h5>
                            <br>
                            <span class="text-muted" id="spanUserResponse"></span>
                        </div>
                        <div class="ibox-content">
                            <form>
                                <div class="">
                                    <div class="col-sm-12 col-md-12">
                                        <section id="sectionUser">
                                            <div class="row">
                                                <h3>Usuário</h3>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div class="form-group">
                                                        <label class="col-form-label" for="inputFullName">Nome
                                                            completo</label>
                                                        <input type="text" class="form-control input"
                                                            name="inputFullName" id="inputFullName" required
                                                            data-user />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="hr-line-dashed"></div>
                                        </section>
                                        <section id="sectionDevice">
                                            <div class="row">
                                                <h3>Aparelho</h3>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div class="form-group">
                                                        <label class="col-form-label"
                                                            for="inputDeviceName">Nome/Local</label>
                                                        <input type="text" class="form-control input"
                                                            name="inputDeviceName" id="inputDeviceName" required
                                                            data-device />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div class="form-group">
                                                        <div class="col-md-6"></div>
                                                        <label class="col-form-label" for="inputDeviceIp">IP do
                                                            aparelho</label>
                                                        <input type="text" class="form-control input"
                                                            name="inputDeviceIp" id="inputDeviceIp" required
                                                            data-device />
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-group">
                                                        <div class="col-md-6"></div>
                                                        <label class="col-form-label"
                                                            for="inputRecipeCapacity">Capacidade(L)</label>
                                                        <input type="number" class="form-control input"
                                                            name="inputRecipeCapacity" id="inputRecipeCapacity" required
                                                            data-device />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div class="form-group">
                                                        <div class="col-md-6"></div>
                                                        <label class="col-form-label" for="inputNetworkName">Nome da
                                                            rede</label>
                                                        <input type="text" class="form-control" name="inputNetworkName"
                                                            id="inputNetworkName" required data-device />
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-group">
                                                        <div class="col-md-6"></div>
                                                        <label class="col-form-label" for="inputNetworkPassword">Senha
                                                            da
                                                            rede</label>
                                                        <input type="password" class="form-control"
                                                            name="inputNetworkPassword" id="inputNetworkPassword"
                                                            required data-device />
                                                    </div>
                                                </div>
                                            </div>
                                        </section>
                                        <section id="sectionButtons">
                                            <div class="row mt-3">
                                                <div class="col">
                                                    <button class="btn btn-primary" type="submit" name="buttonAddDevice"
                                                        id="buttonAddDevice">
                                                        Cadastrar
                                                    </button>
                                                </div>
                                                <div class="col">
                                                    <button class="btn btn-primary" type="submit"
                                                        name="buttonAddAnotherDevice" id="buttonAddAnotherDevice">
                                                        Cadastrar e adicionar outro aparelho
                                                    </button>
                                                </div>
                                            </div>
                                        </section>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4"></div>
            </div>
        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="../js/jquery-3.1.1.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.js"></script>
    <script src="../js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="../js/inspinia.js"></script>
    <script src="../js/plugins/pace/pace.min.js"></script>

    <!-- Custom scripts test -->
    <script>
        /**
         * [x] criar function para validar cpf 
         * [x] criar function para abrir o form de aparelhos
         * [x] criar function para bloquear o field de CPF
         * [x] criar function para digitar letras maiúsculas
         * [x] criar function para limpar os dados do form de aparelho
         * [x] criar function para salvar um aparelho e mudar de pagina
         * [x] criar function para salvar um aparelho e continuar na pagina
         */
        var cpf = "99999999999";
        /* Verifica, ao carregar a página, se o campo de cpf/cnpj está preenchido */
        $(document).ready(function () {
            if ($("#inputCpfCnpj").val() === "") {
                $("#divAddForm").hide();
            }
        });
        set

        $(".input").on("input", function (event) {
            this.value = this.value.toUpperCase();
        })

        $("#inputCpfCnpj").on("input", function (event) {
            validateCpfCnpj($("#inputCpfCnpj"));
        });

        $("#buttonCheckUser").on("click", function (event) {
            event.preventDefault();
            if (validateCpfCnpj($("#inputCpfCnpj"))) {
                handleFormShow();
            }
        });

        $("#buttonAddDevice").on("click", function (event) {
            event.preventDefault();
            addDevice();
        });

        $("#buttonAddAnotherDevice").on("click", function (event) {
            event.preventDefault();
            addAnotherDevice();
        });


        function formatCpfCnpj(text) {
            const badchars = /[^\d]/g
            const maskCpf = /(\d{3})(\d{3})(\d{3})(\d{2})/
            const maskCnpj = /(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/
            const value = new String(text).replace(badchars, "");
            if (value.length === 11) {
                return value.replace(maskCpf, "$1.$2.$3-$4");
            } else if (value.length === 14) {
                return value.replace(maskCnpj, "$1.$2.$3/$4-$5");
            } else {
                return value;
            }
        }

        function removeSpecialCharacters(fieldValue) {
            let value = new String(fieldValue).replace(/(\-|\/|\.)/g, '');
            return value;
        }

        function handleFormShow() {
            if (removeSpecialCharacters($("#inputCpfCnpj").val()) === cpf) {
                $("#spanUserResponse").text("Usuário já cadastrado.")
                $("#divAddForm").fadeIn(1000);
                $("#inputCpfCnpj").prop('disabled', true);
                $("#sectionUser").hide();
            } else {
                $("#spanUserResponse").text("Usuário não cadastrado.")
                $("#divAddForm").fadeIn(1000);
                $("#inputCpfCnpj").prop('disabled', true);
            }
        }

        function validateCpfCnpj(idField) {
            if (idField.val().length === 11 || idField.val().length === 14 || idField.val().length ===
                18) {
                $(idField).val(formatCpfCnpj(idField.val()));
                $(idField).css("border-color", "#1ab394");
                return true;
            } else {
                $(idField).val(formatCpfCnpj(idField.val()));
                $(idField).css("border-color", "#ED5565");
                return false;
            }
        }

        function validateInputsForm(dataAttribute) {
            let inputValues = $("[" + dataAttribute + "]").get();
            let result = true;
            inputValues.forEach((input, index) => {
                if ($(input).val().length === 0) {
                    $(input).css("border-color", "#ED5565");
                    result = false;
                } else {
                    $(input).css("border-color", "#1ab394");
                }
            });
            return result;
        }

        function clearFields(dataAttribute) {
            let inputValues = $("[" + dataAttribute + "]").get();
            inputValues.forEach((input, index) => {
                $(input).val("");
                $(input).css("border-color", "#e5e6e7")
            });
        }

        function addDevice() { 
            let isUserValidated = validateInputsForm("data-user");
            let isDeviceValidated = validateInputsForm("data-device");
            /**
             * Montar aqui o objeto para os post
             */
            if ($("#spanUserResponse").text() === "Usuário já cadastrado.") {
                if (isDeviceValidated) {
                    alert("Aparelho cadastrado com sucesso!");
                    window.location.href = 'consultar.html';
                }
            } else {
                if (isDeviceValidated && isUserValidated) {
                    alert("Aparelho cadastrado com sucesso!");
                    window.location.href = 'consultar.html';
                }
            }
         }

         function addAnotherDevice() { 
            let isUserValidated = validateInputsForm("data-user");
            let isDeviceValidated = validateInputsForm("data-device");
            /**
             * Montar aqui o objeto para os post
             */
            if ($("#spanUserResponse").text() === "Usuário já cadastrado.") {
                if (isDeviceValidated) {
                    alert("Aparelho cadastrado com sucesso!");
                    clearFields("data-device");
                }
            } else {
                if (isDeviceValidated && isUserValidated) {
                    alert("Aparelho cadastrado com sucesso!");
                    clearFields("data-device");
                }
            }
          }
    </script>
</body>

</html>